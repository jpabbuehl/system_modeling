---
title: "System modeling"
output: html_document
---

Required packages (in order)
```{r}
library(cluster)
library(simpleaffy)
library(IsoGene)
library(drc)
library(tcltk)
library(caret)
library(mlbench)
library(Hmisc)
library(randomForest)
library(dendextend)
library(e1071)
```

Load data processed by Aroma with probeset rematching
only arrays that passed through QC (~50 did not)
```{r}
source('main.R')
load(file='dream.rda')
load(file='dream quantile.rda')
load(file='dream cyclicloess.rda')
load(file='druglist.rda')
load(file='drug concentration.rda')
```

Merge replicate and clustering
```{r}
eset<-rm_outlier_replicate(eset,druglist)
esetQ<-rm_outlier_replicate(esetQ,c(druglist)
esetC<-rm_outlier_replicate(esetC,druglist)

# Clustering over time
clustering<-knn_subpopulation(eset)# ok
clustering<-knn_subpopulation(esetQ)# ok
clustering<-knn_subpopulation(esetC)# Not promising

# Clustering at leatest timepoint
population<-knn_process(eset,druglist,clustering,timepoint=3)
```

Signature definition
```{r}
# Detect 
relevant_probeset<-time_filter(eset,druglist,ctrl='DMSO')

# Correlation dosage and gene expression
signatures<-model_fit(eset,druglist,relevant_probeset)

# Machine learning for signature optimization
optimal_signature<-machine_learning(eset,druglist,signatures,baseline='Others')
```

Drug-Drug interaction matrix and hierarchy prediction
```{r}
interaction<-population_targeting(eset,druglist,optimal_signature,within.sig=TRUE,timepoint=6)
hierarchy<-assymetric_killing(interaction,population)
```

Prediction
```{r}
analysis<-prediction(druglist,interaction,hierarchy,hierarchy_flag=TRUE,drug_flag=FALSE)
rank<-dream_ranking(analysis)
```

Parameters to test:
data: eset,esetQ,esetC
knn: metric: manattan, euclidean
timepoint KNN: 1,2,3
time_filter:  ctrl =DMSO, Media, Time..
              theshold=0.95
              time=1, 2, all

model_fit:  timepoint=6,12,24
            drug_flag=TRUE
optimal_signature:  disjoint=FALSE
                    min=20
                    max=100
                    baseline='DMSO', # DMSO, Media or Others
